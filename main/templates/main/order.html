<!DOCTYPE html>
<html style="font-size: 16px;" lang="ru">
<head>

    <style>
        .hr {
            text-align: center;
            display: flex;
            margin-left: 5px;
            border: 1px solid #000;
            padding-left: 100px;
            text-align: center;
            width: 1000px;
            
        }

        .r {
            text-align: center;
            display: flex;
            margin-left: 5px;
            width: 200px;
            border: 1px solid #000;
            padding-left: 100px;
            text-align: center;
            
        }

        .pc {
            margin-left: 15px;
            display: flex;
            font-size: 25px;
            text-align: center;
            padding-left: 50px;
        }

        .pp {

            font-size: 20px;
            text-align: left;

        }

        .first {
            padding-left: 80px
        }
        .create-btn {
    background-color: #478ac9;
    color: #ffffff;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 10px;
    height: 40px;
    margin-top: 15px;
}

.create-btn:hover {
    background-color: #478ac9d3;
    cursor: pointer;
}

.edit {

    border: none;
    font-size: 16px;
    border-radius: 10px;
    margin-top: 15px;
    margin-right: 5px;
}

.edit:hover {

    cursor: pointer;
}

.close {

    font-size: 16px;
    border-radius: 10px;

    margin-top: 15px;
    margin-right: 5px;
}

.close:hover {
    cursor: pointer;
}

table {
  border-collapse: collapse;
}

th, td {
  border: 1px solid #000;
  width: 200px;
}
tr {
    display: flex;
}
td {
    display: flex;
    justify-content: center;
    align-items: center;
}
.saven:hover {
    cursor: pointer;
}

    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="1 home work, to do list">
    <meta name="description" content="">
    <title>Главная</title>
    <link rel="stylesheet" href="static/main.css" media="screen">
    <link rel="stylesheet" href="static/nicepage.css" media="screen">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <script class="u-script" type="text/javascript" src="static/jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="static/nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 5.2.4, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">


    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": ""
}</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Главная">
    <meta property="og:type" content="website">
</head>
<body data-home-page="Главная.html" data-home-page-title="Главная" class="u-body u-xl-mode" data-lang="ru">
<header class="u-clearfix u-container-align-center u-header u-palette-1-base u-sticky u-sticky-f6b6 u-header" id="sec-d045"><div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
        <nav class="u-menu u-menu-one-level u-offcanvas u-menu-1">

          <div class="u-custom-menu u-nav-container">
            <ul class="u-nav u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="create">Добавление ордера</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="order">Список ордеров</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="crship">Добавление шипинга</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="shiplist">Список шипингов</a>
</li></ul>
          </div>
        </nav>
      </div></header>
<section class="u-clearfix u-section-1" id="sec-a943">
    <div class="u-clearfix u-sheet u-sheet-1">
        <img class="u-image u-image-contain u-image-default u-image-1" src="static/img/2560px-Air_Astana_logo.svg.png"
             alt="" data-image-width="2560" data-image-height="625">
        {% for el in a %}
    <details>
        <summary class='btn'>
            <div class="hr">
                <h3 style="margin-right: 800px;" class="u-text u-text-default u-text-6">{{ el.OrderName }}</h3>
                <button type="button" class="create-btn" onclick="createOrder({{ el.pk }})" id="createBtn{{ el.pk }}">
                    <span class="create-icon">+</span>
                </button>
            </div>
        </summary>
        <div style="display: flex;">
            <div class="r">
                <h3 class="pp">{{ el.OrderDate }}</h3>
            </div>
            <div>
                <table>
                    <thead>
                        <tr>
                            <th>Detail Name</th>
                            <th>Count</th>
                            <th>Delivery Country</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for detail in el.Details.all %}
                            <tr>
                                <td id="b{{ detail.pk }}">{{ detail.DetailName }}</td>
                                <td id="ba{{ detail.pk }}">{{ detail.Count }}</td>
                                <td id="ban{{ detail.pk }}">{{ detail.DeliveryCountry }}</td>
                                <td>
                                    <a class="edit" title="Edit" data-toggle="tooltip" id="editBtn{{ detail.pk }}" onclick="editDetail({{ detail.pk }})">
                                        <i class="material-icons">&#xE254;</i>
                                    </a>
                                    <a class="close" onClick="deleteDetail({{ detail.pk }})" id="deleteBtn{{ detail.pk }}" title="Delete" data-toggle="tooltip">
                                        <i class="material-icons">&#xE872;</i>
                                    </a>
                                </td>
                            </tr>
                            <tr id="editForm{{ detail.pk }}" style="display: none;">
                                    <form method="POST" action="/order/{{ detail.pk }}/" class="edit-form" style="display: flex;">
                                        {% csrf_token %}
                                        <td><input type="text" name="detail_name" value="{{ detail.DetailName }}"></td>
                                        <td><input type="text" name="count" value="{{ detail.Count }}"></td>
                                        <td><input type="text" name="delivery_country" value="{{ detail.DeliveryCountry }}"></td>
                                        <td><button type="submit">Save</button></td>                                                                         
                                    </form>
                            </tr>
                        {% endfor %}
                        <tr style="display:none; "  id="forma{{ el.pk }}">
                                    <form action="order" method="POST" novalidate style="display: flex;">
                                        {% csrf_token %}
                                        <td><div >
                                            {{ form.DetailName }}
                                        </div></td>
                                        <td><div >
                                            {{ form.Count }}
                                        </div></td>
                                        <td><div >
                                            {{ form.DeliveryCountry }}
                                        </div><input type="hidden" name="OrderName" value="{{ el.OrderName }}">
                                        <input type="hidden" name="OrderDate" value="{{ el.OrderDate|date:'Y-m-d' }}" id="id_OrderDate"></td>
                                        <td><a class="saven" title="save" data-toggle="tooltip">
                                            <span class="tick-icon">&#10004;</span>
                                        </a>
                                        </td>
                                            
                                    </form>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>
    </details>
{% endfor %}



        <a href="/" class="u-btn u-btn-submit u-button-style">Выйти</a>

    </div>

</section>


<footer class="u-align-center u-clearfix u-footer u-grey-80 u-footer" id="sec-c230">
    <div class="u-clearfix u-sheet u-sheet-1">
        <p class="u-small-text u-text u-text-variant u-text-1">Team NIS for Air Astana</p>
    </div>
</footer>


<script>


function editDetail(detailId) {
  // Скрыть текстовые элементы
  document.getElementById('b' + detailId).style.display = 'none';
  document.getElementById('ba' + detailId).style.display = 'none';
  document.getElementById('ban' + detailId).style.display = 'none';

  // Скрыть кнопки "Редактировать" и "Удалить"
  document.getElementById('editBtn' + detailId).style.display = 'none';
  document.getElementById('deleteBtn' + detailId).style.display = 'none';

  // Отобразить форму редактирования
  document.getElementById('editForm' + detailId).style.display = 'flex';
  document.getElementById('forma' + detailId).style.display = 'flex';
}

function saveDetail(detailId) {
  // Получить значения из полей ввода
  var detailName = document.getElementById('detailName' + detailId).value;
  var count = document.getElementById('count' + detailId).value;
  var deliveryCountry = document.getElementById('deliveryCountry' + detailId).value;

  // Обновить текстовые элементы с новыми значениями
  document.getElementById('b' + detailId).textContent = detailName;
  document.getElementById('ba' + detailId).textContent = count;
  document.getElementById('ban' + detailId).textContent = deliveryCountry;

  // Скрыть форму редактирования
  document.getElementById('editForm' + detailId).style.display = 'none';

  // Показать текстовые элементы
  document.getElementById('b' + detailId).style.display = 'block';
  document.getElementById('ba' + detailId).style.display = 'block';
  document.getElementById('ban' + detailId).style.display = 'block';

  // Показать кнопки "Редактировать" и "Удалить"
  document.getElementById('editBtn' + detailId).style.display = 'block';
  document.getElementById('deleteBtn' + detailId).style.display = 'block';
}


function createOrder(orderId) {
    var formId = "forma" + orderId;
    var form = document.getElementById(formId);
    if (form.style.display === "flex") {
        form.style.display = "none";
    } else {
        form.style.display = "flex";
    }
}


    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    const csrfToken = getCookie('csrftoken') || document.querySelector('[name=csrfmiddlewaretoken]').value;


    function deleteDetail(pk) {
        fetch(`/orders/delete/${pk}/`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken,
            },
        }).then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            window.location.href = "/order";

        }).catch(error => {
            console.error('There was a problem with the fetch operation:', error);
        });
    }

</script>



</body>
</html>